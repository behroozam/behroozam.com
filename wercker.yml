box: ruby
build:
  steps:
    # Install dependencies
    - script:
        name: bundle - nokogiri use sys lib
        code: bundle config build.nokogiri --use-system-libraries

    - bundle-install

    # Execute jeykyll doctor command to validate the
    # site against a list of known issues.
    - script:
        name: jekyll doctor
        code: bundle exec jekyll doctor

    - script:
        name: generate site
        code: bundle exec jekyll build --trace --destination ./_site

    - create-file:
        name: generate robots.txt
        filename: ./_site/robots.txt
        overwrite: true
        content: |-
          User-agent: *
          Allow: /
          Sitemap: http://behroozam.com/sitemap.xml

deploy:
  steps:
    - install-packages:
      packages: git ssh-client
    - leipert/git-push:
       gh_oauth: $GIT_TOKEN
       repo: behroozam/behroozam.com
       branch: gh-pages
       basedir: public
